from collections.abc import Sequence

import pytest

from zoo_mcp.server import mcp


@pytest.mark.asyncio
async def test_text_to_cad_success():
    prompt = "Create a 10x10x10 cube."
    response = await mcp.call_tool("text_to_cad", arguments={"prompt": prompt})
    assert isinstance(response, Sequence | dict)
    assert "/*\nGenerated by Text-to-CAD" in response[1]["result"]


@pytest.mark.asyncio
async def test_text_to_cad_failure():
    prompt = "the quick brown fox jumps over the lazy dog"
    response = await mcp.call_tool("text_to_cad", arguments={"prompt": prompt})
    assert isinstance(response, Sequence | dict)
    assert "400 Bad Request" in response[1]["result"]
